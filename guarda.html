<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>disegna</title>


    <script src="libraries/p5.min.js"></script>
    <script src="libraries/p5.sound.min.js"></script>
  </head>

  <body>
    <script src="sketch2.js"></script>
  </body>
</html>


let dragging = false;
let offsetX = 0;
let offsetY = 0;
let ufoX = 0;
let ufoY = 0;

function setup() {
  createCanvas(windowWidth, windowHeight, WEBGL);
  noStroke();
}

function draw() {
  background(0);

  ambientLight(40);
  directionalLight(255, 255, 255, 1, 1, -1);

  // Controlla se UFO esce dal canvas, se sì, resetta a centro
  let halfWidth = width / 2;
  let halfHeight = height / 2;
  if (ufoX < -halfWidth || ufoX > halfWidth || ufoY < -halfHeight || ufoY > halfHeight) {
    ufoX = 0;
    ufoY = 0;
  }

  // Se stai trascinando, aggiorna posizione UFO rispetto al mouse e offset
  if (dragging) {
    ufoX = mouseX - halfWidth - offsetX;
    ufoY = mouseY - halfHeight - offsetY;
  }

  push();
  // Sposta l’intero UFO secondo ufoX e ufoY
  translate(ufoX, ufoY, 0);

  // Calcola distanza mouse-centro UFO sullo schermo (per velocità rotazione)
  let d = dist(mouseX, mouseY, halfWidth + ufoX, halfHeight + ufoY);
  let rotationSpeed = 0.005;
  if (d < 150) {
    rotationSpeed = 0.03;
  }

  // Rotazioni UFO
  rotateY(frameCount * rotationSpeed);
  rotateY(frameCount * 0.005);

  // Sfere rotanti e colorate
  let numSpheres = 10;
  let radius = 250;
  for (let i = 0; i < numSpheres; i++) {
    let angle = map(i, 0, numSpheres, 0, TWO_PI);
    let x = cos(angle + frameCount * 0.02) * radius;
    let z = sin(angle + frameCount * 0.02) * radius;

    push();
    translate(x, 20, z);

    let r = 90 + sin(frameCount * 0.05 + i) * 75;
    let g = 250 + sin(frameCount * 0.03 + i + PI / 2) * 75;
    let b = 255;

    let s = map(sin(frameCount * 0.1 + i), -1, 1, 0.8, 1.2);

    ambientMaterial(r, g, b);
    scale(s);
    sphere(20, 24, 24);
    pop();
  }

  // Uovo centrale
  push();
  let r = 180 + sin(frameCount * 0.05) * 40;
  let g = 200 + sin(frameCount * 0.07 + PI / 3) * 30;
  let b = 255;
  let alpha = map(sin(frameCount * 0.1), -1, 1, 80, 200);

  fill(r, g, b, alpha);

  scale(2.0, 4, 1.2);
  sphere(50, 100, 100);
  pop();

  // Luci disco (sfere grandi)
  for (let i = 0; i < 12; i++) {
    let angle = map(i, 0, 12, 0, TWO_PI);
    let x = cos(angle) * 120;
    let z = sin(angle) * 120;

    push();
    translate(x, 20, z);
    let r = abs(sin(frameCount * 0.1 + i)) * 255;
    let g = abs(sin(frameCount * 0.1 + i + 2)) * 255;
    let b = abs(sin(frameCount * 0.1 + i + 4)) * 255;
    ambientMaterial(r, g, b);
    sphere(88);
    pop();
  }

  pop(); // Fine traslazione UFO
}

function mousePressed() {
  let halfWidth = width / 2;
  let halfHeight = height / 2;

  // Calcola distanza mouse-centro UFO (in coordinate canvas)
  let d = dist(mouseX, mouseY, halfWidth + ufoX, halfHeight + ufoY);

  if (d < 150) { // se clicchi vicino all'UFO abilita drag
    dragging = true;
    offsetX = mouseX - (halfWidth + ufoX);
    offsetY = mouseY - (halfHeight + ufoY);
  }
}

function mouseReleased() {
  dragging = false;
}

function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
}

